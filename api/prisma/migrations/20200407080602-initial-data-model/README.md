# Migration `20200407080602-initial-data-model`

This migration has been generated by Saimon Moore at 4/7/2020, 8:06:02 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "email" text  NOT NULL DEFAULT '',
    "firstName" text   ,
    "gender" "Gender" NOT NULL DEFAULT 'FEMALE',
    "id" SERIAL,
    "lastName" text   ,
    "lastName2" text   ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Singer" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "defaultPart" "VoiceType"  ,
    "id" SERIAL,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Director" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" SERIAL,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Song" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "director" integer  NOT NULL ,
    "id" SERIAL,
    "singer" integer  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" integer   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Part" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" SERIAL,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" integer   ,
    "voiceType" "VoiceType" NOT NULL DEFAULT 'SOPRANO',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Concert" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "director" integer  NOT NULL ,
    "dueBy" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" SERIAL,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" integer   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_ConcertToSinger" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_ConcertToSong" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_PartToSong" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Singer_user" ON "public"."Singer"("user")

CREATE UNIQUE INDEX "Director_user" ON "public"."Director"("user")

CREATE UNIQUE INDEX "_ConcertToSinger_AB_unique" ON "public"."_ConcertToSinger"("A","B")

CREATE  INDEX "_ConcertToSinger_B_index" ON "public"."_ConcertToSinger"("B")

CREATE UNIQUE INDEX "_ConcertToSong_AB_unique" ON "public"."_ConcertToSong"("A","B")

CREATE  INDEX "_ConcertToSong_B_index" ON "public"."_ConcertToSong"("B")

CREATE UNIQUE INDEX "_PartToSong_AB_unique" ON "public"."_PartToSong"("A","B")

CREATE  INDEX "_PartToSong_B_index" ON "public"."_PartToSong"("B")

ALTER TABLE "public"."Singer" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Director" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Song" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Song" ADD FOREIGN KEY ("singer")REFERENCES "public"."Singer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Song" ADD FOREIGN KEY ("director")REFERENCES "public"."Director"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Part" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Concert" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Concert" ADD FOREIGN KEY ("director")REFERENCES "public"."Director"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ConcertToSinger" ADD FOREIGN KEY ("A")REFERENCES "public"."Concert"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ConcertToSinger" ADD FOREIGN KEY ("B")REFERENCES "public"."Singer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ConcertToSong" ADD FOREIGN KEY ("A")REFERENCES "public"."Concert"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ConcertToSong" ADD FOREIGN KEY ("B")REFERENCES "public"."Song"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PartToSong" ADD FOREIGN KEY ("A")REFERENCES "public"."Part"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PartToSong" ADD FOREIGN KEY ("B")REFERENCES "public"."Song"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200407080602-initial-data-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+datasource DS {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = env("BINARY_TARGET")
+}
+
+// Define your own datamodels here and run `yarn redwood db save` to create
+// migrations for them.
+
+enum Gender {
+  FEMALE
+  MALE
+}
+
+model User {
+  id Int @id @default(autoincrement())
+  email String @unique
+  firstName String?
+  lastName String?
+  lastName2 String?
+  gender Gender @default(FEMALE)
+  director Director?
+  singer Singer?
+  songs Song[]
+  parts Part[]
+  concerts Concert[]
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Singer {
+  id Int @id @default(autoincrement())
+  defaultPart VoiceType?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  user User
+  concerts Concert[]
+  songs Song[]
+}
+
+model Director {
+  id Int @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  user User
+  songs Song[]
+  concerts Concert[]
+}
+
+model Song {
+  id Int @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  user User?
+  concerts Concert[]
+  singer Singer
+  director Director
+  parts Part[]
+}
+
+enum VoiceType {
+  SOPRANO
+  MEZZOSOPRANO
+  CONTRALTO
+  COUNTERTENOR
+  TENOR
+  TREBLE
+  BARITONE
+  BASS
+}
+
+model Part {
+  id Int @id @default(autoincrement())
+  voiceType VoiceType
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  user User?
+  songs Song[]
+}
+
+model Concert {
+  id Int @id @default(autoincrement())
+  dueBy DateTime
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  songs Song[]
+  singers Singer[]
+  director Director
+}
```


